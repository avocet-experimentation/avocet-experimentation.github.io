---
title: Architecture
description: This section provides an overview of Architecture.
---

Each Avocet installation is comprised of:
- A MongoDB database for storing feature flags, experiments, environments, and other supporting data.
- An administrative dashboard for managing data stored in Mongo.
- A server that lets dashboard users query MongoDB, and responds to requests from client applications for feature flag values.
Additionally, Avocet offers two packages:
- An SDK package that allows JavaScript applications to request feature flag values
- A core package with supplementary code used across components.

![Avocet Architecture](/avocet-architecture.png)

## Core Schema

### Feature Flags

Avocet offers `boolean`, `string`, and `number` flag types to accommodate various use cases.

![Feature Flag Types](/feature-flag-types.png)

Flags have a default value, can be toggled on and off per environment (discussed below), and are further customizable through “override rules” that override the flag’s default value within a specific environment. The first type of override rule is the “Forced Value” rule.

“Forced Value” rules simply set a value for a flag within a single environment. This rule is useful for changing functionality in ways that cannot be achieved by simply toggling a flag off in an environment (which would cause its value to evaluate to the global fallback, `null`).

![Forced Value Override Rule](/forced-value-override-rule.png)

### Experiments

The other type of override rule is the Experiment. Experiments aim to evaluate how changes in features, design, or functionality affect user behavior, system performance, or other key metrics. 

In Avocet, subjects (users) are randomly assigned to groups, each of which receives a series of treatments. Experimental treatments are defined by one or more pairings of a feature flag and a value to attribute to that flag, and are assigned a duration for which those pairings are to be applied. One or more treatments can be applied to each group; treatments are applied one at a time during the experiment’s life cycle. Once all treatments have elapsed, an experiment ends.

![Experiment Visualization](/experiment-visualization.png)

By allowing multiple flags to be used as independent variables in a single experiment, developers can more easily build experiments testing combinations of features, or controlling for another potentially confounding feature by fixing it to a specified value in all groups.

When defining an experiment, developers can start from A/B or Switchback templates, or build it from scratch. All experiments require at least two treatments to compare against each other. An A/B experiment requires at least two groups, with at least one treatment assigned per group. A switchback experiment requires only one group, but at least two treatments. All treatments will be assigned to the same user group. Typically, treatments should be of equal duration, but this is left to the user to decide. Finally, users can also specify the number of times to repeat the entire sequence of treatments, which is especially useful for switchback tests.

### Environments

In commercial software development processes, it’s common for versions of an application to move through stages, or “environments,” such as “development,” “testing,” and “production.” To support this compartmentalization, Avocet lets users define any number of environments. Override rules customize the behavior of feature flags within a specific environment. This allows for the same application to behave differently depending on how the flagging SDK is configured, which determines the environment the application runs in. This allows Avocet users to provide changes in functionality specifically to development teams, testing and QA teams, or any other groups of their choice.

![Environments Visualization](/environments-visualization.png)

### SDK Connections

SDK connections enable feature flagging on applications. Each connection has an associated environment and API key, and. An API key must be passed into the SDK when initialized. This key is sent to the feature flagging API along with every request, and if the key doesn’t correspond to an SDK connection, the request is rejected.

## Administrative Dashboard

The Admin dashboard is a React application that allows Avocet users to configure and manage feature flags, experiments, and environments. 

For example, users can adjust a flag's value to determine whether it is active or not in a given environment. They can also add rules for flags to customize their behavior on a per-environment basis.

Users can create experiments either using provided templates for switchback or A/B tests, or build their own free-form. Even after an experiment is created (but not yet started), users can manage flags, groups, treatments, and define dependent variables. 

## Feature Flagging & Experimentation Server

Cattails is a Fastify server that mediates all interactions with feature flag, experiment, and environment data, from both the admin dashboard and from client applications when they request flag values.

On the dashboard-facing side, requests are authenticated using Auth0, and database queries occur through a GraphQL layer. 

On the client-facing side, requests are authenticated by the presence of a valid API key, and the flag value returned to the client is determined by attempting to apply any override rules defined on the flag for the client’s environment.

## Database

Avocet stores feature flags, experiments, environments, and client SDK connections in a local MongoDB instance that can be deployed onto a dedicated machine. Schema validation and transactions are implemented on cattails via the Mongo driver. A discussion of why we chose MongoDB.

## SDK Package

The SDK package permits client-side and server-side JavaScript applications to fetch feature flag values from cattails.
